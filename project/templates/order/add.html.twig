{% extends 'base.html.twig' %}

{% block title %}Récapitulatif de la commande GeekBook !{% endblock %}

{% block body %}
<div class="bg-gray-100 dark:bg-gray-800 dark:text-white">
    <div class="body mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="mx-auto max-w-2xl py-16 sm:py-24 lg:max-w-none lg:py-32">

            <div class="grid sm:px-10 lg:grid-cols-2 lg:px-20 xl:px-32">
                    {% if app.session.get('cartData') is defined %}
                <div class="px-4 pt-8">

                        <p class="text-xl font-medium">Résumer commande</p>
                        <p class="text-gray-400">Vérifier vos articles</p>
                        {% for cart in basket.products %} 
                        <div class="mt-8 space-y-3 rounded-lg border bg-white px-2 py-4 sm:px-6">
                            <div class="flex flex-col rounded-lg bg-white sm:flex-row">
                                {% for img in cart.book.images|slice(0,1) %}
                                    <img class="m-2 h-24 w-28 rounded-md border object-cover object-center" src="{{img.url}}" alt="{{cart.book.title}}" />
                                {% endfor %}
                                <div class="flex w-full flex-col px-4 py-4">
                                    <span class="font-semibold">{{cart.book.title}}</span>
                                    <span class="float-right text-gray-400">Qte : {{app.session.get('cartData').data.quantityCart}}</span>
                                    <p class="text-lg font-bold">{{app.session.get('cartData').data.subTotalHT|number_format(2, ',', '.')}} €<p>
                                </div>
                            </div>
                            <div class="flex flex-col rounded-lg bg-white sm:flex-row">
                                <div class="m-2 h-24 w-28" src="" alt=""></div>
                                <div class="flex w-full flex-col px-4 py-4">
                                    <span class="font-semibold"></span>
                                    <span class="float-right text-gray-400"></span>
                                    <p class="mt-auto text-lg">{{cart.book.description}}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <h2 class="">le panier est vide</h2>
                    {% endif %}
                    </div>
                    <div class="mt-10 bg-gray-50 px-4 pt-8 lg:mt-0">
                        <p class="text-xl font-medium">Adresse & Transporteur</p>
                        <p class="text-gray-400">Vos choix d'adresse et de transport</p>
                        <div class="">
                            <label for="email" class="mt-4 mb-2 block text-sm font-medium">Adresse choisi</label>
                            <div class="relative">
                                {{address|replace({'[eol]' : '<br/>'})|raw}}
                            </div>
                            <label for="card-holder" class="mt-4 mb-2 block text-sm font-medium">Transporteur</label>
                            <div class="relative">
                                {{carrier|replace({'[eol]' : '<br/>'})|raw}}
                            </div>
                            <label for="card-no" class="mt-4 mb-2 block text-sm font-medium">Information</label>
                            <div class="flex">
                                <div class="relative w-7/12 flex-shrink-0">
                                {% if informations %}
                                    {{informations|replace({'[eol]' : '<br/>'})|raw}}
                                {% endif %}
                                </div>
                               
                            </div>
                        </div>

                                
                            
                        <!-- Total -->
                        <div class="mt-6 border-t border-b py-2">
                            <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">Prix HT</p>
                            <p class="font-semibold text-gray-900">{{basket.data.subTotalHT}} €</p>
                            </div>
                            <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">Taxe</p>
                            <p class="font-semibold text-gray-900">{{basket.data.taxe}} €</p>
                            </div>
                            <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">Prix du transporteur : {{carrier.name}}</p>
                            <p class="font-semibold text-gray-900">{{carrier.price|number_format(2, ',', '.')}} €</p>
                            </div>
                        </div>
                        <div class="mt-6 flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">Total</p>
                            <p class="text-2xl font-semibold text-gray-900">{{basket.data.subTotalTTC + carrier.price}} €</p>
                        </div>
                            <form action="{{ path('app_stripe_checkout') }}" method="POST">
                                <button type="submit" id="checkout-button">Checkout</button>
                            </form>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script src="{{asset('build/app.js')}}"></script>
<script src="https://js.stripe.com/v3/"></script>
{% endblock %}