type: install
name: GeekBook
id: geekbook
categories: ["apps/dev-and-admin-tools"]

description: |
  GeekBook deployment manifest file for Jelastic
  
ssl: true

nodes:
  - image: traefik:v2.0.2
    count: 1
    cloudlets: 8
    nodeGroup: cp
    displayName: Traefik
    volumes:
      - /letsencrypt
      - /etc/ssl/traefik
      - /var/run/docker.sock

  - image: postgres:15-alpine
    count: 1
    cloudlets: 8
    nodeGroup: cp
    displayName: PostgreSQL
    volumes:
      - /var/www/html/postgresql/data

  - image: duncanidaho/geekbook:latest
    count: 1
    cloudlets: 8
    fixedCloudlets: 1
    nodeGroup: cp
    displayName: GeekBook
    isSLBAccessEnabled: false
    dependsOn:
      - PostgreSQL
      - Traefik
    volumes:
      - /var/www/html/

  - image: httpd:2.4
    count: 1
    cloudlets: 8
    nodeGroup: cp
    displayName: Apache
    dependsOn:
      - PostgreSQL
      - Traefik
    volumes:
      - /usr/local/apache2/conf.d/default-ssl.conf
      - /usr/local/apache2/ssl
      - /var/www/html

  - image: schickling/mailcatcher
    count: 1
    cloudlets: 8
    nodeGroup: cp
    displayName: Mailer

  - image: getmeili/meilisearch:latest
    count: 1
    cloudlets: 8
    nodeGroup: cp
    displayName: Meilisearch
    volumes:
      - /meilisearch_data

  - image: dunglas/mercure
    count: 1
    cloudlets: 8
    nodeGroup: cp
    displayName: Mercure
    volumes:
      - /data
      - /config
  
  - image: reverse-proxy-https-helper
    count: 1
    cloudlets: 2
    nodeGroup: cp
    displayName: reverseProxy
    volumes:
      - /etc/ssl/traefik

  - image: gkbook
    count: 1
    cloudlets: 8
    nodeGroup: cp
    displayName: Gkbook
    volumes:
      - /var/www/html
    dependsOn:
      - PostgreSQL
      - Traefik


success: |
  Your GeekBook environment is ready to go!
